<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAINPAGE</title>
    <link rel="stylesheet" href="layout.css" type="text/css">
    <link rel="stylesheet" href="http://code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="http://code.jquery.com/jquery-1.10.2.js"></script>
    <script src="http://code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>


    <style>

        body {
            background-color: #f0f0f0;
        }

        a {
            display: inline-block;
            padding: 0;
            margin: 0;
            text-decoration-line: none;
        }

        #userinfo {
            line-height: normal;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        table,
        th,
        td {
            border: 1px solid #ddd;
        }

        th,
        td {
            padding: 8px;
            text-align: left;
        }

        #pagination button {
            margin: 0 4px;
            padding: 8px 16px;
        }

        #pagination {
            text-align: center;
        }
    </style>

</head>

<body>
    <header id="header">
        <div class="wrapper">
            <a href=""><img class="title" src="https://cdn.discordapp.com/attachments/1256039752633810944/1265215717045960774/3.png?ex=66a0b375&is=669f61f5&hm=00518810bbf38d8ed5a7400c1720615da4bf713d71b38dd872a4862e8bd72c47&" alt=""></a>
            <div id="selectmenu">
                <p id="qwer"></p>
            </div>
            <input id="search" type="text"><input style="width: 30px; height: 54px;" type="button">
            <div id="userinfo">
                <p id="userpmo"></p>
                <p id="username"></p>
            </div>
            <input type="button" id="logout" name="Logout" value="Logout"
                style="width: 60px; height: 30px; margin-left: 50px;">
        </div>
    </header>
    <div class="accordion">
        <div class="cate">
            <span class="menu">
                <a href="#" class="menulink">계획</a>
                <a href="javascript:void(0);" class="subopen"></a>
            </span>
            <ul>
                <li><a href="주문관리.html">발주</a></li>
                <li><a href="계획수립.html">계획 수립</a></li>
            </ul>
        </div>
        <div class="cate">
            <span class="menu">
                <a href="#" class="menulink">작업지시</a>
                <a href="javascript:void(0);" class="subopen"></a>
            </span>
            <ul>
                <li><a href="작업지시서.html">작업지시서</a></li>
                <li><a href="인사관리.html">작업별 업무 절차</a></li>
            </ul>
        </div>
        <div class="cate">
            <span class="menu">
                <a href="#" class="menulink">작업수행</a>
                <a href="javascript:void(0);" class="subopen"></a>
            </span>
            <ul>
                <li><a href="진행현황.html">진행 현황</a></li>
                <li><a href="출하현황.html">출하 현황</a></li>
                <li><a href="인사관리.html">완료 보고</a></li>
            </ul>
        </div>
        <div class="cate">
            <span class="menu">
                <a href="#" class="menulink">자재관리</a>
                <a href="javascript:void(0);" class="subopen"></a>
            </span>
            <ul>
                <li><a href="재고현황.html">재고 현황</a></li>
                <li><a href="인사관리.html">반출입 대장</a></li>    
            </ul>
        </div>
        <div class="cate">
            <span class="menu">
                <a href="#" class="menulink">인사관리</a>
                <a href="javascript:void(0);" class="subopen"></a>
            </span>
            <ul>
                <li><a href="인사관리.html">인사조회</a></li>
            </ul>
        </div>
        <div class="cate">
            <span class="menu">
                <a href="#" class="menulink">BOM</a>
                <a href="javascript:void(0);" class="subopen"></a>
            </span>
            <ul>
                <li><a href="인사관리.html">제품 유형별 BOM</a></li>
                <li><a href="인사관리.html">코드 관리</a></li>
            </ul>
        </div>
        <div class="cate">
            <span class="menu">
                <a href="#" class="menulink">공지사항</a>
                <a href="javascript:void(0);" class="subopen"></a>
            </span>
            <ul>
                <li><a href="인사관리.html">공지사항</a></li>
                <li><a href="인사관리.html">건의사항</a></li>
            </ul>
        </div>
    </div>
    <div id="mainsel" style="width: 79%;  border: 1px solid black;">
        <div class="sel" style="width: 49%; height: 75%; ">
            <canvas id="line-chart" style="width: 50%; height: 50%;"></canvas>
        </div>
        <div class="notince" style="width: 50%; height: 99%; display: inline-block;">
            <div class="t1" style="width: 100%; height: 78%;">
                <div style="height: 515px;">
                    <table>
                        <tr>
                            <td style="text-align: center;" colspan="4">
                                <h2>게시판</h2>
                            </td>
                        </tr>
                        <tr>
                            <th>번호</th>
                            <th>제목</th>
                            <th>작성자</th>
                            <th>작성날짜</th>
                        </tr>
                        <tbody id="posts">
                            <tr class="qwe">
                                <td>23</td>
                                <td><a href="article0.html">안녕하세요</a></td>
                                <td>김승환</td>
                                <td>2024.05.04</td>
                            </tr>
                            <tr class="qwe">
                                <td>2</td>
                                <td><a href="article1.html">안녕하세요</a></td>
                                <td>김승환</td>
                                <td>2024.05.04</td>
                            </tr>
                            <tr class="qwe">
                                <td>1</td>
                                <td><a href="article2.html">안녕하세요</a></td>
                                <td>김승환</td>
                                <td>2024.05.04</td>
                            </tr>
                            <tr class="qwe">
                                <td>1</td>
                                <td><a href="article3.html">안녕하세요</a></td>
                                <td>김승환</td>
                                <td>2024.05.04</td>
                            </tr>
                            <tr class="qwe">
                                <td>1</td>
                                <td><a href="article4.html">안녕하세요</a></td>
                                <td>김승환</td>
                                <td>2024.05.04</td>
                            </tr>
                            <tr class="qwe">
                                <td>1</td>
                                <td><a href="article5.html">안녕하세요</a></td>
                                <td>김승환</td>
                                <td>2024.05.04</td>
                            </tr>
                            <tr class="qwe">
                                <td>1</td>
                                <td><a href="article6.html">aaa</a></td>
                                <td>김승환</td>
                                <td>2024.05.04</td>
                            </tr>
                            <tr class="qwe">
                                <td>1</td>
                                <td><a href="article7.html">안녕하세요</a></td>
                                <td>김승환</td>
                                <td>2024.05.04</td>
                            </tr>
                            <tr class="qwe">
                                <td>1</td>
                                <td><a href="article8.html">안녕하세요</a></td>
                                <td>김승환</td>
                                <td>2024.05.04</td>
                            </tr>
                            <tr class="qwe">
                                <td>1</td>
                                <td><a href="article9.html">안녕하세요</a></td>
                                <td>456</td>
                                <td>2024.05.04</td>
                            </tr>
                            <tr class="qwe">
                                <td>1</td>
                                <td><a href="article10.html">안녕하세요</a></td>
                                <td>789</td>
                                <td>2024.05.04</td>
                            </tr>
                            <tr class="qwe">
                                <td>1</td>
                                <td><a href="article11.html">안녕하세요</a></td>
                                <td>김승환</td>
                                <td>2024.05.04</td>
                            </tr>
                            <tr class="qwe">
                                <td>1</td>
                                <td><a href="article12.html">안녕하세요</a></td>
                                <td>김승환</td>
                                <td>2024.05.04</td>
                            </tr>
                            <tr class="qwe">
                                <td>1</td>
                                <td><a href="article13.html">안녕하세요</a></td>
                                <td>김승환</td>
                                <td>2024.05.04</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div id="pagination"></div>
            </div>
            <div class="scc">
                <input class="sch" type="text" name="search" placeholder="검색어를 입력하세요">
                <button class="sb" name="검색" value="검색">검색</button>
            </div>
            <div class="empty"></div>
            <div class="btndiv">
                <button class="btn" onclick="location.href='notice.html'">글쓰기</button>
            </div>
        </div>
    </div>
    </div>

    <script>
        window.onload = function () {
            (function ($) {
                $('.cate ul').hide();//버튼 누르기 전에 ul 리스트들 숨기기
                $('.cate .menu .subopen').click(function () {
                    if ($(this).hasClass('active')) {
                        $(this).parent().next().slideUp('slow');
                        $(this).removeClass('active');
                    }
                    else {
                        $('.accordion').find('.active').parent().next().slideUp('slow');
                        $('.accordion').find('.active').removeClass('active');
                        $(this).parent().next().slideDown('slow');
                        $(this).addClass('active');
                    }
                });
            })(jQuery);

            let userpmo = document.getElementById('userpmo');
            let username = document.getElementById('username');
            let decodedData = decodeURIComponent(new URLSearchParams(window.location.search)
                .get('param1'));//get 방식으로 받아온 유저 정보를 json객체로 만들기 위한 과정
            let decodedDataJson = JSON.parse(decodedData);//json화

            // userpmo.textContent = decodedDataJson[Object.keys(decodedDataJson)[0]]; // 추출 후 텍스트 수정
            // username.textContent = decodedDataJson[Object.keys(decodedDataJson)[1]]; // 추출 후 텍스트 수정

            // 로그아웃 버튼
            document.getElementById('logout').addEventListener('click', function () {
                if (confirm("로그아웃 하시겠습니까?")) {
                    alert("로그아웃 되었습니다")
                    window.location.href = "login.html"
                } else {
                    alert("로그아웃 취소되었습니다")
                }
            })
            // 초기 페이지네이션 버튼 생성 및 첫 페이지 게시글 표시
            let qwe = document.querySelectorAll('.qwe');
            qwe.forEach(function (e, index) {
                let td = e.children;
                let json = {
                    id: td[0].textContent,
                    title: td[1].textContent,
                    writer: td[2].textContent,
                    date: td[3].textContent
                }
                pts.push(json)
            });
            createPaginationButtons1(pts.length, postsPerPage);
            displayPosts1();
        }

        let qwe;
        let pts = [];
        let indexs = 0;
        let content = document.getElementById('posts').innerHTML;
        let parser = new DOMParser();
        let doc = parser.parseFromString(content, 'text/html');
        let links = doc.querySelectorAll('a');
        let hrefs = [];
        links.forEach(link => {
            hrefs.push(link.href);
        });

        console.log(hrefs[0]);
        const postsPerPage = 10; // 페이지당 게시글 수
        let currentPage = 1; // 현재 페이지

        // 페이지네이션 함수
        function paginatePosts(pts, page, postsPerPage) {
            const start = (page - 1) * postsPerPage;
            const end = start + postsPerPage;
            return pts.slice(start, end);
        }

        // 페이지네이션 버튼 생성 함수
        function createPaginationButtons1(totalPosts, postsPerPage) {//
            const totalPages = Math.ceil(totalPosts / postsPerPage);
            let buttons = '';

            for (let i = 1; i <= totalPages; i++) {
                buttons += `<button onclick="goToPage1(${i})">${i}</button>`;
            }
            document.querySelector('#pagination').innerHTML = buttons;
        }

        function createPaginationButtons2(totalPosts, postsPerPage) {
            const totalPages = Math.ceil(totalPosts / postsPerPage);
            let buttons = '';

            for (let i = 1; i <= totalPages; i++) {
                buttons += `<button onclick="goToPage2(${i})">${i}</button>`;
            }
            document.querySelector('#pagination').innerHTML = buttons;
        }

        // 페이지 이동 함수
        function goToPage1(page) {
            currentPage = page;
            displayPosts1();
        }
        function goToPage2(page) {
            currentPage = page;
            displayPosts2();
        }

        // 게시글 표시 함수
        function displayPosts1() {
            let paginatedPosts = paginatePosts(pts, currentPage, postsPerPage);
            let postsHtml = '';

            paginatedPosts.forEach((post) => {
                postsHtml +=
                    `<tr class=qwe>
                    <td>${post.id}</td>
                    <td><a href="${hrefs[indexs]}">${post.title}</td>
                    <td>${post.writer}</td>
                    <td>${post.date}</td>
                </tr>`;

                indexs = indexs + 1;
            });
            document.getElementById('posts').innerHTML = postsHtml;
        }

        function displayPosts2() {
            let paginatedPosts = paginatePosts(septs, currentPage, postsPerPage);
            let postsHtml = '';
            let index = 0;
            paginatedPosts.forEach(post => {
                postsHtml +=
                    `<tr class=qwe>
                    <td>${post.id}</td>
                    <td><a href="/article${reindex[index]}.html">${post.title}</a></td>
                    <td>${post.writer}</td>
                    <td>${post.date}</td>
                </tr>`;
                console.log(reindex[index]);
                index = index + 1;
            });
            document.getElementById('posts').innerHTML = postsHtml;
        }

        document.addEventListener('DOMContentLoaded', function () {
            new Chart(document.getElementById("line-chart"), {
                type: 'line',
                data: {
                    labels: [1 + '월', 2 + '월', 3 + '월', 4 + '월', 5 + '월', 6 + '월', 7 + '월', 8 + '월', 9 + '월', 10 + '월', 11 + '월', 12 + '월'],
                    datasets: [{
                        data: [50, 40, 60, 90, 50, 60, 70, 80, 69, 100, 110, 120],
                        label: "월별 매출 동향",
                        borderColor: "#3e95cd",
                        fill: false
                    }]
                },
                options: {
                    title: {
                        display: true,
                        text: '월별 매출 동향'
                    }
                }
            });
        });

        let septs = [];
        let reindex = [];
        document.querySelector('.sb').addEventListener('click', function () {
            let searchText = document.querySelector('.sch').value.trim().toLowerCase();
            septs = [];
            reindex = [];
            pts.forEach(function (row, index) {
                let found = false;
                if (row.title.toLowerCase().includes(searchText)) {
                    reindex.push(index);
                    septs.push(row);
                }
            });
            console.log(reindex);
            createPaginationButtons2(septs.length, postsPerPage);
            displayPosts2();

        });

        //검색 input에서 엔터키 누르면 검색 버튼이 눌리게
        document.querySelector('.sch').addEventListener('keyup', function () {
            if (event.keyCode === 13) {
                event.preventDefault();
                document.querySelector('.sb').click();
            }
        })
    </script>
</body>

</html>